<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jersey Sublimation Price (Daily) â€” Rotated (Sizes left)</title>
<style>
  :root{
    --primary:#4400ff;
    --bg:#f9f9fc;
    --border:#ddd;
    --accent:#ff6b6b;
    --text:#111827;
    --oversize-bg:#ffe5e5;
    --oversize-text:#a80000;
  }
  body{
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    margin:20px;
    background:var(--bg);
    color:var(--text);
  }
  .branding{ color:var(--primary); font-weight:700; margin-bottom:8px; }
  h1{ margin:0 0 12px 0; color:var(--primary); font-size:1.2rem; }

  .controls{ margin:8px 0 14px 0; }
  .controls button{
    background:var(--primary); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; margin-right:8px;
  }
  .controls button.secondary{ background:#fff; color:var(--primary); border:1px solid var(--border); }

  /* wrapper that scrolls both axes */
  .sizing-wrapper{
    width:100%;
    border-radius:10px;
    background:#fff;
    border:1px solid var(--border);
    overflow:auto; /* important */
    max-height:650px;
  }

  table.sizing-table{
    border-collapse:collapse;
    width:max-content;       /* allow horizontal scrolling */
    min-width:1000px;
  }
  table.sizing-table th, table.sizing-table td{
    border:1px solid var(--border);
    padding:8px 10px;
    white-space:nowrap;
    text-align:center;
    font-size:0.95rem;
    background-clip: padding-box;
  }

  /* TOP product headers sticky (stick on vertical scroll) */
  th.product-top{
    position: sticky;
    top: 0;
    background:#f0f0ff;
    z-index:40;
    font-weight:700;
    padding:10px 12px;
  }

  /* LEFT size column sticky */
  td.size-col, th.size-col {
    position: sticky;
    left: 0;
    background:#e8f8ff;
    z-index:45;
    font-weight:700;
    text-align:left;
    padding-left:12px;
    min-width:120px;
  }

  /* top-left corner cell (empty) must be above both */
  th.corner {
    position: sticky;
    top: 0;
    left: 0;
    z-index:50;
    background:#f0f0ff;
    text-align:left;
    padding-left:12px;
    min-width:120px;
  }

  /* oversize highlight */
  td.oversized { background:var(--oversize-bg); color:var(--oversize-text); font-weight:700; }

  input.qty {
    width:68px;
    padding:5px;
    border-radius:6px;
    border:1px solid #cfcfcf;
    text-align:center;
  }

  .totals-row th, .totals-row td { background:#fff7f7; font-weight:700; }

  .summary{
    display:flex;
    gap:16px;
    margin-top:12px;
    align-items:flex-start;
  }
  .grand {
    background:#fff; padding:12px; border-radius:8px; box-shadow:0 3px 10px rgba(10,10,20,0.03); border:1px solid var(--border);
  }
  .grand p{ margin:6px 0; font-weight:600; }
  @media print {
    body *{ visibility:hidden; }
    .printable, .printable *{ visibility:visible; }
    .printable{ position:absolute; left:0; top:0; width:100% }
    .sizing-wrapper{ max-height:none; overflow:visible; }
  }
</style>
</head>
<body>

<div class="branding">Inspirazs Sdn. Bhd.</div>
<h1>Jersey Sublimation Price (Daily)</h1>

<div class="controls no-print">
  <button onclick="window.print()">Print</button>
  <button class="secondary" onclick="exportCSV()">Export CSV</button>
</div>

<div class="sizing-wrapper printable" id="grid-wrap">
  <table class="sizing-table" id="sizing-table" role="table" aria-label="Sizing by product">
    <thead id="thead">
      <!-- generated -->
    </thead>
    <tbody id="tbody">
      <!-- generated -->
    </tbody>
    <tfoot id="tfoot">
      <!-- generated -->
    </tfoot>
  </table>
</div>

<div class="summary printable">
  <div class="grand">
    <h3 style="margin:0 0 8px 0;">Order Summary</h3>
    <div id="print-summary"></div>
    <p>Total Normal: RM <span id="grand-normal">0.00</span></p>
    <p>Total Promo: RM <span id="grand-promo">0.00</span></p>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const headers = document.querySelectorAll("thead tr th:not(.size-col)");
    headers.forEach((th, index) => {
        const original = th.innerText.trim();
        th.innerText = `${index + 1}. ${original}`;
    });
});
</script>
<script>
/* ADULT PRODUCTS (no kids) */
const products = [
  // For adult product prices: some use arrays (per-size) from your previous data; fallback uses last value
  { key: "ADULT SS - R", normal: [19.5,19.5,19.5,19.5,19.5,19.5,19.5,22.5,25.5,27.5,29.5,31.5,33.5,35.5,37.5], promo: [15.5,15.5,15.5,15.5,15.5,15.5,15.5,18.5,21.5,23.5,25.5,27.5,29.5,31.5,33.5] },
  { key: "ADULT SS - C", normal: [25.5,25.5,25.5,25.5,25.5,25.5,25.5,28.5,31.5,33.5,35.5,37.5,39.5,41.5,43.5], promo: [20.5,20.5,20.5,20.5,20.5,20.5,20.5,24.5,27.5,29.5,31.5,33.5,35.5,37.5,39.5] },
  { key: "ADULT LS - R", normal: [21.5,21.5,21.5,21.5,21.5,21.5,21.5,24.5,27.5,29.5,31.5,33.5,35.5,37.5,39.5], promo: [18.5,18.5,18.5,18.5,18.5,18.5,18.5,21.5,24.5,26.5,28.5,30.5,32.5,34.5,36.5] },
  { key: "ADULT LS - C", normal: [31.5,31.5,31.5,31.5,31.5,31.5,31.5,34.5,37.5,39.5,41.5,43.5,45.5,47.5,49.5], promo: [23.5,23.5,23.5,23.5,23.5,23.5,23.5,27.5,30.5,32.5,34.5,36.5,38.5,40.5,42.5] },
  { key: "ADULT MUSLIMAH - R", normal: 28.0, promo: 28.0 },
  { key: "ADULT MUSLIMAH - C", normal: 33.0, promo: 33.0 }
];

/* adult sizes XS -> 11XL */
const sizes = ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"];

/* helper to get price (handle scalar or array) */
function getPrice(product, idx, type){
  const v = product[type];
  if(Array.isArray(v)){
    if(idx < v.length) return Number(v[idx]);
    return Number(v[v.length - 1]);
  }
  return Number(v);
}

/* build thead */
function buildTable(){
  const thead = document.getElementById("thead");
  const tbody = document.getElementById("tbody");
  const tfoot = document.getElementById("tfoot");
  thead.innerHTML = "";
  tbody.innerHTML = "";
  tfoot.innerHTML = "";

  // thead: corner + product headers
  let th = "<tr>";
  th += `<th class="corner size-col">Size</th>`; // top-left corner sticky
  products.forEach((p, pi) => {
    th += `<th class="product-top" data-pidx="${pi}">${p.key}</th>`;
  });
  th += "</tr>";
  thead.innerHTML = th;

  // tbody: sizes as rows
  sizes.forEach((sz, si) => {
    let r = `<tr data-size="${si}">`;
    r += `<td class="size-col">${sz}</td>`;
    products.forEach((p, pi) => {
      r += `<td><input class="qty" type="number" min="0" value="0" data-pidx="${pi}" data-sidx="${si}" aria-label="${p.key} ${sz} qty"></td>`;
    });
    r += `</tr>`;
    tbody.insertAdjacentHTML('beforeend', r);
  });

  // tfoot: totals rows per product (Qty, Normal RM, Promo RM)
  // first column labels are sticky (size-col)
  let footQty = `<tr class="totals-row"><th class="size-col">Total QTY</th>`;
  let footNormal = `<tr class="totals-row"><th class="size-col">Total Normal (RM)</th>`;
  let footPromo = `<tr class="totals-row"><th class="size-col">Total Promo (RM)</th>`;
  products.forEach((p,pi)=>{
    footQty += `<td class="col-total-qty" data-pidx="${pi}">0</td>`;
    footNormal += `<td class="col-total-normal" data-pidx="${pi}">0.00</td>`;
    footPromo += `<td class="col-total-promo" data-pidx="${pi}">0.00</td>`;
  });
  footQty += `</tr>`; footNormal += `</tr>`; footPromo += `</tr>`;
  tfoot.insertAdjacentHTML('beforeend', footQty);
  tfoot.insertAdjacentHTML('beforeend', footNormal);
  tfoot.insertAdjacentHTML('beforeend', footPromo);
}

/* calculate totals per product (column) & grand totals */
function updateTotals(){
  const qtyInputs = document.querySelectorAll("input.qty");
  // init
  const totals = products.map(()=>({qty:0, normal:0, promo:0}));
  let grandNormal = 0, grandPromo = 0;

  qtyInputs.forEach(inp=>{
    const p = Number(inp.dataset.pidx);
    const s = Number(inp.dataset.sidx);
    const qty = Math.max(0, parseInt(inp.value)||0);
    if(qty <= 0) return;
    const norm = getPrice(products[p], s, 'normal');
    const promo = getPrice(products[p], s, 'promo');
    totals[p].qty += qty;
    totals[p].normal += qty * norm;
    totals[p].promo += qty * promo;
    grandNormal += qty * norm;
    grandPromo += qty * promo;
  });

  // write totals to footer
  totals.forEach((t, i) => {
    const tdQ = document.querySelector(`.col-total-qty[data-pidx="${i}"]`);
    const tdN = document.querySelector(`.col-total-normal[data-pidx="${i}"]`);
    const tdP = document.querySelector(`.col-total-promo[data-pidx="${i}"]`);
    if(tdQ) tdQ.textContent = t.qty;
    if(tdN) tdN.textContent = t.normal.toFixed(2);
    if(tdP) tdP.textContent = t.promo.toFixed(2);
  });

  // update summary
  const summaryRows = [];
  totals.forEach((t,i)=>{
    if(t.qty>0) summaryRows.push([products[i].key, t.qty, t.normal.toFixed(2), t.promo.toFixed(2)]);
  });
  let html = "<table style='border-collapse:collapse;width:100%'><tr style='background:#f0f0ff'><th style='text-align:left;padding:6px;border:1px solid var(--border)'>Item</th><th style='padding:6px;border:1px solid var(--border)'>Qty</th><th style='padding:6px;border:1px solid var(--border)'>Normal (RM)</th><th style='padding:6px;border:1px solid var(--border)'>Promo (RM)</th></tr>";
  summaryRows.forEach(r=> html += `<tr><td style='padding:6px;border:1px solid var(--border)'>${r[0]}</td><td style='padding:6px;border:1px solid var(--border)'>${r[1]}</td><td style='padding:6px;border:1px solid var(--border)'>${r[2]}</td><td style='padding:6px;border:1px solid var(--border)'>${r[3]}</td></tr>`);
  html += "</table>";
  document.getElementById("print-summary").innerHTML = html;
  document.getElementById("grand-normal").textContent = grandNormal.toFixed(2);
  document.getElementById("grand-promo").textContent = grandPromo.toFixed(2);
}

/* CSV export per product totals */
function exportCSV(){
  // ensure totals updated
  updateTotals();
  const rows = [["Item","Qty","Normal (RM)","Promo (RM)"]];
  const qtyCells = document.querySelectorAll(".col-total-qty");
  qtyCells.forEach(td=>{
    const p = Number(td.dataset.pidx);
    const qty = Number(td.textContent)||0;
    if(qty === 0) return;
    const norm = document.querySelector(`.col-total-normal[data-pidx="${p}"]`).textContent;
    const promo = document.querySelector(`.col-total-promo[data-pidx="${p}"]`).textContent;
    rows.push([products[p].key, qty, norm, promo]);
  });
  if(rows.length===1){ alert("No quantities entered."); return; }
  const csv = "data:text/csv;charset=utf-8," + rows.map(r=> r.map(c => `"${String(c).replace(/"/g,'""')}"`).join(",")).join("\n");
  const link = document.createElement("a");
  link.href = encodeURI(csv);
  link.download = "jersey_summary.csv";
  document.body.appendChild(link);
  link.click();
  link.remove();
}

/* initial build */
buildTable();

/* live update via delegation for performance */
document.getElementById("grid-wrap").addEventListener("input", (e)=>{
  if(e.target && e.target.matches("input.qty")){
    if(e.target.value === "" || Number(e.target.value) < 0) e.target.value = 0;
    updateTotals();
  }
});

/* initial totals */
updateTotals();
</script>
</body>
</html>

