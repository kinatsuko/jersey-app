<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jersey Sublimation Price (Daily)</title>
<style>
:root {
    --primary: #4400ff;
    --light-bg: #f9f9fc;
    --border-color: #ddd;
    --accent: #ff6b6b;
    --text-dark: #333;
    --text-light: #666;
    --oversize-bg: #ffe5e5;
    --oversize-text: #a80000;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--light-bg);
    color: var(--text-dark);
    margin: 0;
    padding: 20px;
}

h1, h2 {
    color: var(--primary);
}

.branding {
    font-size: 1.4em;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--primary);
}

.button-container {
    margin-bottom: 20px;
}

.button-container button {
    background-color: var(--primary);
    color: #fff;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    margin-right: 10px;
}

.button-container button:hover {
    background-color: #3300cc;
}

/* Scrollable wrapper for sticky headers and columns */
.sizing-wrapper {
    width: 100%;
    overflow: auto;  /* both horizontal and vertical scroll */
    max-height: 600px; /* optional, vertical scroll */
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: #fff;
}

.sizing-table {
    border-collapse: collapse;
    min-width: 1500px; /* wide table for all sizes */
}

.sizing-table th,
.sizing-table td {
    border: 1px solid var(--border-color);
    padding: 8px 12px;
    white-space: nowrap;
    text-align: center;
}

/* Sticky top header (sizes row) */
.sizing-table thead th {
    position: sticky;
    top: 0;
    background: #f0f0ff;
    z-index: 30;
}

/* Sticky PRODUCT column */
.product-col {
    position: sticky;
    left: 0;
    min-width: 180px;
    background: #f8f1d3;
    font-weight: 700;
    border-right: 3px solid #c49b26;
    text-align: left;
    padding-left: 8px;
    z-index: 25;
}

/* Sticky NECK column */
.neck-col {
    position: sticky;
    left: 180px; /* same as product-col width */
    min-width: 80px;
    background: #e8f1ff;
    font-weight: 600;
    border-right: 3px solid #2e6ac7;
    z-index: 24;
}

/* Oversized sizes styling */
.oversized {
    background-color: var(--oversize-bg);
    color: var(--oversize-text);
    font-weight: bold;
}

/* Input fields */
input[type="number"] {
    width: 60px;
    padding: 5px;
    border-radius: 5px;
    text-align: center;
}

/* Grand totals */
.grand-totals {
    margin-top: 20px;
    padding: 15px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.grand-totals table {
    width: 100%;
    border-collapse: collapse;
}

.grand-totals th,
.grand-totals td {
    border: 1px solid var(--border-color);
    padding: 6px 10px;
    text-align: center;
}

@media print {
    body * { visibility: hidden; }
    .printable, .printable * { visibility: visible; }
    .printable { position: absolute; left:0; top:0; }
}
</style>
</head>
<body>

<div class="branding">Inspirazs Sdn. Bhd.</div>
<h1 class="no-print">Jersey Sublimation Price (Daily)</h1>

<div class="button-container no-print">
    <button onclick="window.print()">Print Page</button>
    <button onclick="exportCSV()">Export CSV</button>
</div>

<div class="sizing-wrapper" id="tables"></div>

<div class="grand-totals printable">
    <h2>Order Summary</h2>
    <div id="print-summary"></div>
    <p><strong>Total Normal Price:</strong> RM <span id="grand-normal">0.00</span></p>
    <p><strong>Total Promotion Price:</strong> RM <span id="grand-promo">0.00</span></p>
</div>

<script>
const products = [
  { name: "KIDS SHORT SLEEVE", neck: "R", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 19.5, promo: 15.5 },
  { name: "KIDS SHORT SLEEVE", neck: "C", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 25.5, promo: 20.5 },
  { name: "KIDS LONG SLEEVE", neck: "R", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 21.5, promo: 18.5 },
  { name: "KIDS LONG SLEEVE", neck: "C", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 31.5, promo: 23.5 },
  { name: "ADULT SHORT SLEEVE", neck: "R", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 22.5, promo: 18.5 },
  { name: "ADULT SHORT SLEEVE", neck: "C", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 28.5, promo: 24.5 },
  { name: "ADULT LONG SLEEVE", neck: "R", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 24.5, promo: 21.5 },
  { name: "ADULT LONG SLEEVE", neck: "C", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 34.5, promo: 27.5 },
  { name: "ADULT MUSLIMAH", neck: "R", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 28, promo: 28 },
  { name: "ADULT MUSLIMAH", neck: "C", sizes: ["XS","S","M","L","XL","2XL","3XL","4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"], normal: 33, promo: 33 },
];

const tablesContainer = document.getElementById("tables");

products.forEach((product, idx) => {
    const sizeLen = product.sizes.length;
    const table = document.createElement("table");
    table.className = "sizing-table";
    
    let html = "<thead><tr><th class='product-col'>Product</th><th class='neck-col'>Neck</th>";
    product.sizes.forEach(size => html += `<th>${size}</th>`);
    html += "<th>Total QTY</th><th>Total Normal</th><th>Total Promo</th></tr></thead>";

    html += "<tbody><tr>";
    html += `<td class='product-col'>${product.name}</td><td class='neck-col'>${product.neck}</td>`;
    for(let i=0;i<sizeLen;i++) html += `<td><input type='number' min='0' value='0' class='qty' data-idx='${idx}' data-size='${i}'></td>`;
    html += "<td class='total-qty' data-idx='"+idx+"'>0</td><td class='total-sales-normal' data-idx='"+idx+"'>0.00</td><td class='total-sales-promo' data-idx='"+idx+"'>0.00</td></tr>";

    // Normal Price row
    html += "<tr><td class='product-col'>Normal RM</td><td class='neck-col'></td>";
    for(let i=0;i<sizeLen;i++) {
        const val = Array.isArray(product.normal)? product.normal[i] : product.normal;
        const oversize = ["4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"].includes(product.sizes[i]) ? "oversized" : "";
        html += `<td class='${oversize}'>${val.toFixed(2)}</td>`;
    }
    html += "<td colspan='3'></td></tr>";

    // Promo Price row
    html += "<tr><td class='product-col'>Promo RM</td><td class='neck-col'></td>";
    for(let i=0;i<sizeLen;i++) {
        const val = Array.isArray(product.promo)? product.promo[i] : product.promo;
        const oversize = ["4XL","5XL","6XL","7XL","8XL","9XL","10XL","11XL"].includes(product.sizes[i]) ? "oversized" : "";
        html += `<td class='${oversize}'>${val.toFixed(2)}</td>`;
    }
    html += "<td colspan='3'></td></tr>";

    html += "</tbody>";
    table.innerHTML = html;
    tablesContainer.appendChild(table);
});

// Update totals dynamically
function updateTotals(){
    const qtyInputs = document.querySelectorAll(".qty");
    const totals = {};
    let grandNormal = 0;
    let grandPromo = 0;

    qtyInputs.forEach(input=>{
        const idx = input.dataset.idx;
        const size = input.dataset.size;
        const qty = parseInt(input.value)||0;
        if(qty===0) return;
        const product = products[idx];
        const norm = Array.isArray(product.normal)? product.normal[size]:product.normal;
        const promo = Array.isArray(product.promo)? product.promo[size]:product.promo;

        totals[idx] = totals[idx]||{name:product.name+" ("+product.neck+")", qty:0, normal:0, promo:0};
        totals[idx].qty += qty;
        totals[idx].normal += qty*norm;
        totals[idx].promo += qty*promo;

        grandNormal += qty*norm;
        grandPromo += qty*promo;
    });

    for(let i=0;i<products.length;i++){
        const tdQty=document.querySelector(".total-qty[data-idx='"+i+"']");
        const tdNormal=document.querySelector(".total-sales-normal[data-idx='"+i+"']");
        const tdPromo=document.querySelector(".total-sales-promo[data-idx='"+i+"']");
        if(totals[i]){
            if(tdQty) tdQty.textContent=totals[i].qty;
            if(tdNormal) tdNormal.textContent=totals[i].normal.toFixed(2);
            if(tdPromo) tdPromo.textContent=totals[i].promo.toFixed(2);
        }else{
            if(tdQty) tdQty.textContent='0';
            if(tdNormal) tdNormal.textContent='0.00';
            if(tdPromo) tdPromo.textContent='0.00';
        }
    }

    // Update summary
    let summaryHTML="<table><tr><th>Item</th><th>Qty</th><th>Normal (RM)</th><th>Promo (RM)</th></tr>";
    Object.values(totals).forEach(data=>{
        summaryHTML+=`<tr><td>${data.name}</td><td>${data.qty}</td><td>${data.normal.toFixed(2)}</td><td>${data.promo.toFixed(2)}</td></tr>`;
    });
    summaryHTML+="</table>";
    document.getElementById("print-summary").innerHTML=summaryHTML;
    document.getElementById("grand-normal").textContent=grandNormal.toFixed(2);
    document.getElementById("grand-promo").textContent=grandPromo.toFixed(2);
}

setInterval(updateTotals,300);

function exportCSV(){
    const rows=[["Item","Qty","Normal (RM)","Promo (RM)"]];
    const qtyInputs = document.querySelectorAll(".qty");
    const totals = {};

    qtyInputs.forEach(input=>{
        const idx=input.dataset.idx;
        const size=input.dataset.size;
        const qty=parseInt(input.value)||0;
        if(qty===0) return;
        const product = products[idx];
        const norm = Array.isArray(product.normal)? product.normal[size]:product.normal;
        const promo = Array.isArray(product.promo)? product.promo[size]:product.promo;
        totals[idx]=totals[idx]||{name:product.name+" ("+product.neck+")", qty:0, normal:0, promo:0};
        totals[idx].qty += qty;
        totals[idx].normal += qty*norm;
        totals[idx].promo += qty*promo;
    });

    Object.values(totals).forEach(data=>{
        rows.push([data.name,data.qty,data.normal.toFixed(2),data.promo.toFixed(2)]);
    });

    const csvContent="data:text/csv;charset=utf-8,"+rows.map(e=>e.join(",")).join("\n");
    const link=document.createElement("a");
    link.setAttribute("href",encodeURI(csvContent));
    link.setAttribute("download","jersey_price_summary.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>

</body>
</html>
